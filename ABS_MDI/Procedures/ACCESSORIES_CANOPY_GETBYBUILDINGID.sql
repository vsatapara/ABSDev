CREATE OR REPLACE PROCEDURE abs_mdi."ACCESSORIES_CANOPY_GETBYBUILDINGID" 
(
    BuildingId IN VARCHAR2,
    OUTPUT_TABLE OUT  SYS_REFCURSOR
)
AS
BEGIN
OPEN OUTPUT_TABLE FOR SELECT
    "AccessoriesCanopyId",
    "BuildingNumber",
    "Select_Elevation",
    "StartColumn",
    "StopColumn",
    "CanopyType",
    "Projection",
    "Slope",
    "Panel",
    "SoffitPanelColor",
    "SoffitGaudge",
    "ReturnDownspouts",
    "Gutter",
    "RoofTieTrimColor",
    "CanopyCornerTrimColor",
    "CanopySillCapTrimColor",
    "SoffitTrimColor",
    "SoffitPanelType",
    "CanopyPanelColor",
    "CanopyPanelGauge",
    "CanopySSClipType",
    "ThermalBlockType",
    "ExtendRoofInsulation",
    "GutterType",
    "GutterSize",
    "DownspoutDrops",
    "IncludeElbow",
    "DownspoutHeight",
    "GutterColor",
    "DownspoutColor",
    "SoffitFramingClearance",
    "HasSnowRetentionSystem",
    "IncludeSnowClipPerPanel",
    "SnowClipQuantity",
    "ColorStripQuantity",
    "RoofPanelType",
    "ReverseRollSoffit",
    "ReverseRollFace",
    "DistFromLeftCorner",
    "Length",
    "HeightLocation",
    "SoffitPanel",
    "SoffitTrim",
    "AtEave",
    "PanelFinish",
    "CanopyFacingSpecial",
    "CanopyFacingWeight",
    "CanopyFacingDeflection",
    "SoffitFacingSpecial",
    "SoffitFacingWeight",
    "SoffitFacingDeflection",
    "Price",
    "Weight",
    "ErrorCode",
    "PriceMBCI",
    "WeightMBCI",
    "DesignIndex",
    "MainBuildingGutter",
    "RoofSquareFeet",
    "WallSquareFeet",
    "SoffitSquareFeet",
    "HeightOfFace",
    "SoffitPanelColorValsparCode",
    "SoffitPanelColorSpecialName",
    "RoofTieTrimColorValsparCode",
    "RoofTieTrimColorSpecialName",
    "CanopyCornerTrimColorValsparCode",
    "CanopyCornerTrimColorSpecialName",
    "CanopySillTrimColorValsparCode",
    "CanopySillTrimColorSpecialName",
    "SoffitTrimColorValsparCode",
    "SoffitTrimColorSpecialName",
    "PanelColorValsparCode",
    "PanelColorSpecialName",
    "GutterColorValsparCode",
    "GutterColorSpecialName",
    "DownspoutColorValsparCode",
    "DownspoutColorSpecialName",
    "IncludeSagAngles",
    "SnowLoad",
    "IsDelete",
    "ProjectId",
    "SoffitPanelColorValsparText",
    "SoffitPanelColorValsparHashCode",
    "RoofTieTrimColorValsparText",
    "RoofTieTrimColorValsparHashCode",
    "CanopyCornerTrimColorValsparText",
    "CanopyCornerTrimColorValsparHashCode",
    "CanopySillCapTrimColorValsparText",
    "CanopySillCapTrimColorValsparHashCode",
    "SoffitTrimColorValsparText",
    "SoffitTrimColorValsparHashCode",
    "PanelColorValsparText",
    "PanelColorValsparHashCode",
    "GutterColorValsparText",
    "GutterColorValsparHashCode",
    "DownspoutColorValsparText",
    "DownspoutColorValsparHashCode",
    "IsValid"
FROM
    "Accessories_Canopy"
     WHERE
                "BuildingNumber" in( 
                        SELECT regexp_substr(BuildingId,'[^,]+', 1, level) from dual
                        connect by regexp_substr(BuildingId, '[^,]+', 1, level) is not null
                        )
             AND NVL("IsDelete",'N') != 'Y'
             AND "IsValid" = 1;
END;
/